"use strict";(self.webpackChunklegacy_donation=self.webpackChunklegacy_donation||[]).push([[273],{6273:(E,c,d)=>{d.r(c),d.d(c,{AdminComponent:()=>j});var l=d(177),r=d(4341),e=d(4438),m=d(3366),g=d(6544);const p=(s,i,t)=>({"bg-yellow-100 text-yellow-800":s,"bg-blue-100 text-blue-800":i,"bg-green-100 text-green-800":t});function u(s,i){if(1&s&&(e.j41(0,"div",12),e.EFF(1),e.k0s()),2&s){const t=e.XpG(2);e.R7$(),e.JRh(t.passwordError)}}function _(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",4)(1,"h2",5),e.EFF(2,"Admin Access"),e.k0s(),e.j41(3,"p",6),e.EFF(4,"Enter admin password to access the dashboard"),e.k0s(),e.j41(5,"div",7)(6,"div")(7,"label",8),e.EFF(8,"Admin Password"),e.k0s(),e.j41(9,"input",9),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.adminPassword,n)||(a.adminPassword=n),e.Njj(n)}),e.k0s()(),e.DNE(10,u,2,1,"div",10),e.j41(11,"button",11),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.checkAdminPassword())}),e.EFF(12," Access Admin Panel "),e.k0s()()()}if(2&s){const t=e.XpG();e.R7$(9),e.R50("ngModel",t.adminPassword),e.R7$(),e.Y8G("ngIf",t.passwordError)}}function h(s,i){1&s&&(e.j41(0,"div",24),e.qSk(),e.j41(1,"svg",25),e.nrm(2,"circle",26)(3,"path",27),e.k0s(),e.joV(),e.j41(4,"p",28),e.EFF(5,"Loading messages..."),e.k0s()())}function x(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",29)(1,"div",30)(2,"p",31),e.EFF(3),e.k0s(),e.j41(4,"button",32),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.loadMessages())}),e.EFF(5," Try Again "),e.k0s()()()}if(2&s){const t=e.XpG(2);e.R7$(3),e.JRh(t.errorMessage)}}function f(s,i){if(1&s){const t=e.RV6();e.j41(0,"tr",39)(1,"td",40),e.EFF(2),e.k0s(),e.j41(3,"td",41),e.EFF(4),e.k0s(),e.j41(5,"td",42),e.EFF(6),e.k0s(),e.j41(7,"td",43),e.EFF(8),e.k0s(),e.j41(9,"td",44)(10,"span",45),e.EFF(11),e.k0s()(),e.j41(12,"td",42),e.EFF(13),e.k0s(),e.j41(14,"td",46)(15,"button",47),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG(3);return e.Njj(a.viewMessage(n))}),e.EFF(16," View "),e.k0s(),e.j41(17,"select",48),e.bIt("change",function(n){const a=e.eBV(t).$implicit,y=e.XpG(3);return e.Njj(y.updateStatus(a,n))}),e.j41(18,"option",49),e.EFF(19,"New"),e.k0s(),e.j41(20,"option",50),e.EFF(21,"Read"),e.k0s(),e.j41(22,"option",51),e.EFF(23,"Responded"),e.k0s()()()()}if(2&s){const t=i.$implicit,o=e.XpG(3);e.R7$(2),e.JRh(t.id),e.R7$(2),e.JRh(t.name),e.R7$(2),e.JRh(t.email),e.R7$(2),e.JRh(t.subject),e.R7$(2),e.Y8G("ngClass",e.sMw(10,p,"new"===t.status,"read"===t.status,"responded"===t.status)),e.R7$(),e.SpI(" ",t.status," "),e.R7$(2),e.SpI(" ",o.formatDate(t.created_at)," "),e.R7$(5),e.Y8G("selected","new"===t.status),e.R7$(2),e.Y8G("selected","read"===t.status),e.R7$(2),e.Y8G("selected","responded"===t.status)}}function v(s,i){1&s&&(e.j41(0,"div",24),e.qSk(),e.j41(1,"svg",52),e.nrm(2,"path",53),e.k0s(),e.joV(),e.j41(3,"h3",54),e.EFF(4,"No messages"),e.k0s(),e.j41(5,"p",55),e.EFF(6,"No contact messages have been received yet."),e.k0s()())}function w(s,i){if(1&s&&(e.j41(0,"div",33)(1,"table",34)(2,"thead",35)(3,"tr")(4,"th",36),e.EFF(5,"ID"),e.k0s(),e.j41(6,"th",36),e.EFF(7,"Name"),e.k0s(),e.j41(8,"th",36),e.EFF(9,"Email"),e.k0s(),e.j41(10,"th",36),e.EFF(11,"Subject"),e.k0s(),e.j41(12,"th",36),e.EFF(13,"Status"),e.k0s(),e.j41(14,"th",36),e.EFF(15,"Date"),e.k0s(),e.j41(16,"th",36),e.EFF(17,"Actions"),e.k0s()()(),e.j41(18,"tbody",37),e.DNE(19,f,24,14,"tr",38),e.k0s()(),e.DNE(20,v,7,0,"div",20),e.k0s()),2&s){const t=e.XpG(2);e.R7$(19),e.Y8G("ngForOf",t.messages),e.R7$(),e.Y8G("ngIf",0===t.messages.length)}}function k(s,i){if(1&s&&(e.j41(0,"div")(1,"label",64),e.EFF(2,"Phone"),e.k0s(),e.j41(3,"p",65),e.EFF(4),e.k0s()()),2&s){const t=e.XpG(3);e.R7$(4),e.JRh(t.selectedMessage.phone)}}function F(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",56),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.closeModal())}),e.j41(1,"div",57),e.bIt("click",function(n){return e.eBV(t),e.Njj(n.stopPropagation())}),e.j41(2,"div",58)(3,"div",59)(4,"h3",60),e.EFF(5,"Message Details"),e.k0s(),e.j41(6,"button",61),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.closeModal())}),e.qSk(),e.j41(7,"svg",62),e.nrm(8,"path",63),e.k0s()()(),e.joV(),e.j41(9,"div",7)(10,"div")(11,"label",64),e.EFF(12,"From"),e.k0s(),e.j41(13,"p",65),e.EFF(14),e.k0s()(),e.DNE(15,k,5,1,"div",3),e.j41(16,"div")(17,"label",64),e.EFF(18,"Subject"),e.k0s(),e.j41(19,"p",65),e.EFF(20),e.k0s()(),e.j41(21,"div")(22,"label",64),e.EFF(23,"Message"),e.k0s(),e.j41(24,"div",66)(25,"p",67),e.EFF(26),e.k0s()()(),e.j41(27,"div")(28,"label",64),e.EFF(29,"Status"),e.k0s(),e.j41(30,"p",65),e.EFF(31),e.k0s()(),e.j41(32,"div")(33,"label",64),e.EFF(34,"Received"),e.k0s(),e.j41(35,"p",65),e.EFF(36),e.k0s()()()()()()}if(2&s){const t=e.XpG(2);e.R7$(14),e.Lme("",t.selectedMessage.name," (",t.selectedMessage.email,")"),e.R7$(),e.Y8G("ngIf",t.selectedMessage.phone),e.R7$(5),e.JRh(t.selectedMessage.subject),e.R7$(6),e.JRh(t.selectedMessage.message),e.R7$(5),e.JRh(t.selectedMessage.status),e.R7$(5),e.JRh(t.formatDate(t.selectedMessage.created_at))}}function b(s,i){if(1&s&&(e.j41(0,"div")(1,"div",13)(2,"h1",14),e.EFF(3,"Admin Dashboard"),e.k0s(),e.j41(4,"p",15),e.EFF(5,"Manage contact messages and system administration"),e.k0s()(),e.j41(6,"div",16)(7,"div",17)(8,"h2",18),e.EFF(9,"Contact Messages"),e.k0s(),e.j41(10,"p",19),e.EFF(11,"View and manage user inquiries"),e.k0s()(),e.DNE(12,h,6,0,"div",20)(13,x,6,1,"div",21)(14,w,21,2,"div",22),e.k0s(),e.DNE(15,F,37,7,"div",23),e.k0s()),2&s){const t=e.XpG();e.R7$(12),e.Y8G("ngIf",t.isLoading),e.R7$(),e.Y8G("ngIf",t.errorMessage),e.R7$(),e.Y8G("ngIf",!t.isLoading&&!t.errorMessage),e.R7$(),e.Y8G("ngIf",t.selectedMessage)}}let j=(()=>{class s{constructor(t,o){this.apiService=t,this.router=o,this.messages=[],this.selectedMessage=null,this.isLoading=!0,this.errorMessage="",this.isAdmin=!1,this.adminPassword="",this.passwordError=""}ngOnInit(){const t=this.apiService.getCurrentUser();t&&"admin"===t.role?(this.isAdmin=!0,this.loadMessages()):this.isAdmin=!1}loadMessages(){this.isLoading=!0,this.errorMessage="",console.log("Attempting to fetch from API..."),fetch("https://kilnenterprise.com/Donations/contact.php",{method:"GET",headers:{"Content-Type":"application/json"}}).then(t=>{if(console.log("API response status:",t.status),!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);return t.json()}).then(t=>{console.log("API response data:",t),this.isLoading=!1,t.success&&t.data?(console.log("Loading real data:",t.data.length,"messages"),this.messages=t.data):(console.log("API returned success=false or no data"),this.errorMessage=t.error||"Failed to load messages")}).catch(t=>{console.log("API fetch failed, loading demo data:",t.message),this.loadDemoData()})}loadDemoData(){this.isLoading=!1,this.messages=[{id:1,name:"John Doe",email:"john.doe@email.com",phone:"+1234567890",subject:"Question about donation process",message:"Hi, I would like to know more about how the donation process works. Can you provide more details?",status:"new",created_at:(new Date).toISOString()},{id:2,name:"Jane Smith",email:"jane.smith@email.com",phone:"+0987654321",subject:"Support for funeral announcement",message:"I need help creating a funeral announcement for my family. Could you guide me through the process?",status:"read",created_at:new Date(Date.now()-864e5).toISOString()},{id:3,name:"Bob Johnson",email:"bob.johnson@email.com",subject:"Technical issue with login",message:"I am having trouble logging into my account. The login button doesn't seem to work.",status:"responded",created_at:new Date(Date.now()-1728e5).toISOString()}]}viewMessage(t){this.selectedMessage=t}closeModal(){this.selectedMessage=null}updateStatus(t,o){const n=o.target.value;fetch(`https://kilnenterprise.com/Donations/contact.php/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:n})}).then(a=>a.json()).then(a=>{t.status=n}).catch(a=>{console.log("API not available, updating locally:",a.message),t.status=n})}checkAdminPassword(){"lastbutone@12345"===this.adminPassword?(this.isAdmin=!0,this.passwordError="",this.loadMessages()):this.passwordError="Invalid admin password"}formatDate(t){const o=new Date(t);return o.toLocaleDateString()+" "+o.toLocaleTimeString()}static{this.\u0275fac=function(o){return new(o||s)(e.rXU(m.G),e.rXU(g.Ix))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-admin"]],standalone:!0,features:[e.aNF],decls:4,vars:2,consts:[[1,"py-20"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8"],["class","max-w-md mx-auto bg-white p-8 rounded-lg shadow-md",4,"ngIf"],[4,"ngIf"],[1,"max-w-md","mx-auto","bg-white","p-8","rounded-lg","shadow-md"],[1,"text-2xl","font-bold","text-gray-900","mb-6"],[1,"text-gray-600","mb-4"],[1,"space-y-4"],["for","adminPassword",1,"block","text-sm","font-medium","text-gray-700"],["id","adminPassword","type","password","placeholder","Enter admin password",1,"mt-1","block","w-full","px-3","py-2","border","border-gray-300","rounded-md","shadow-sm","focus:outline-none","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],["class","text-red-600 text-sm",4,"ngIf"],[1,"w-full","bg-blue-600","text-white","py-2","px-4","rounded-md","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2",3,"click"],[1,"text-red-600","text-sm"],[1,"mb-8"],[1,"text-3xl","font-bold","text-gray-900"],[1,"mt-2","text-gray-600"],[1,"bg-white","shadow-lg","rounded-lg","overflow-hidden"],[1,"px-6","py-4","bg-gray-50","border-b","border-gray-200"],[1,"text-xl","font-semibold","text-gray-900"],[1,"mt-1","text-sm","text-gray-600"],["class","text-center py-12",4,"ngIf"],["class","p-6 text-center",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],["class","fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",3,"click",4,"ngIf"],[1,"text-center","py-12"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-12","w-12","text-blue-600","mx-auto"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"mt-4","text-gray-600"],[1,"p-6","text-center"],[1,"bg-red-50","border","border-red-200","rounded-md","p-4"],[1,"text-red-800"],[1,"mt-2","text-red-600","hover:text-red-800","underline",3,"click"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50"],[1,"px-6","py-4","whitespace-nowrap","text-sm","font-medium","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-500"],[1,"px-6","py-4","text-sm","text-gray-900","max-w-xs","truncate"],[1,"px-6","py-4","whitespace-nowrap"],[1,"inline-flex","px-2","py-1","text-xs","font-semibold","rounded-full",3,"ngClass"],[1,"px-6","py-4","whitespace-nowrap","text-sm","font-medium"],[1,"text-blue-600","hover:text-blue-900","mr-3",3,"click"],[1,"text-sm","border","border-gray-300","rounded","px-2","py-1",3,"change"],["value","new",3,"selected"],["value","read",3,"selected"],["value","responded",3,"selected"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"mx-auto","h-12","w-12","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"],[1,"mt-2","text-sm","font-medium","text-gray-900"],[1,"mt-1","text-sm","text-gray-500"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-50","overflow-y-auto","h-full","w-full","z-50",3,"click"],[1,"relative","top-20","mx-auto","p-5","border","w-11/12","md:w-3/4","lg:w-1/2","shadow-lg","rounded-md","bg-white",3,"click"],[1,"mt-3"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-lg","font-medium","text-gray-900"],[1,"text-gray-400","hover:text-gray-600",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"block","text-sm","font-medium","text-gray-700"],[1,"mt-1","text-sm","text-gray-900"],[1,"mt-1","p-3","bg-gray-50","rounded-md"],[1,"text-sm","text-gray-900","whitespace-pre-wrap"]],template:function(o,n){1&o&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,_,13,2,"div",2)(3,b,16,4,"div",3),e.k0s()()),2&o&&(e.R7$(2),e.Y8G("ngIf",!n.isAdmin),e.R7$(),e.Y8G("ngIf",n.isAdmin))},dependencies:[l.MD,l.YU,l.Sq,l.bT,r.YN,r.xH,r.y7,r.me,r.BC,r.vS],encapsulation:2})}}return s})()}}]);