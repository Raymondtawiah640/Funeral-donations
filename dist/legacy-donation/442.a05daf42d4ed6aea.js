"use strict";(self.webpackChunklegacy_donation=self.webpackChunklegacy_donation||[]).push([[442],{8442:(M,l,a)=>{a.r(l),a.d(l,{LoginComponent:()=>w});var g=a(177),r=a(4341),e=a(4438),d=a(3366),u=a(6544);function m(n,i){if(1&n&&(e.j41(0,"div",23),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.SpI(" ",t.errorMessage," ")}}function f(n,i){if(1&n&&(e.j41(0,"div",24),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.SpI(" ",t.successMessage," ")}}function p(n,i){1&n&&(e.j41(0,"span"),e.EFF(1,"Request Login Code"),e.k0s())}function _(n,i){1&n&&(e.j41(0,"span",25),e.qSk(),e.j41(1,"svg",26),e.nrm(2,"circle",27)(3,"path",28),e.k0s(),e.EFF(4," Sending... "),e.k0s())}function h(n,i){if(1&n){const t=e.RV6();e.j41(0,"form",14),e.bIt("ngSubmit",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onRequestLoginCode())}),e.j41(1,"div")(2,"label",15),e.EFF(3," Email Address * "),e.k0s(),e.j41(4,"div",16)(5,"input",17),e.mxI("ngModelChange",function(o){e.eBV(t);const c=e.XpG();return e.DH7(c.loginForm.email,o)||(c.loginForm.email=o),e.Njj(o)}),e.k0s()()(),e.DNE(6,m,2,1,"div",18)(7,f,2,1,"div",19),e.j41(8,"div")(9,"button",20),e.DNE(10,p,2,0,"span",21)(11,_,5,0,"span",22),e.k0s()()()}if(2&n){const t=e.XpG();e.R7$(5),e.R50("ngModel",t.loginForm.email),e.R7$(),e.Y8G("ngIf",t.errorMessage),e.R7$(),e.Y8G("ngIf",t.successMessage),e.R7$(2),e.Y8G("disabled",t.isLoading||!t.loginForm.email),e.R7$(),e.Y8G("ngIf",!t.isLoading),e.R7$(),e.Y8G("ngIf",t.isLoading)}}function x(n,i){if(1&n&&(e.j41(0,"div",23),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.SpI(" ",t.errorMessage," ")}}function b(n,i){if(1&n&&(e.j41(0,"div",24),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.SpI(" ",t.successMessage," ")}}function C(n,i){1&n&&(e.j41(0,"span"),e.EFF(1,"Sign In"),e.k0s())}function v(n,i){1&n&&(e.j41(0,"span",25),e.qSk(),e.j41(1,"svg",26),e.nrm(2,"circle",27)(3,"path",28),e.k0s(),e.EFF(4," Signing in... "),e.k0s())}function y(n,i){if(1&n&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.SpI("Send new code in ",t.countdown,"s")}}function L(n,i){1&n&&(e.j41(0,"span"),e.EFF(1,"Send New Code"),e.k0s())}function F(n,i){if(1&n){const t=e.RV6();e.j41(0,"form",14),e.bIt("ngSubmit",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onLogin())}),e.j41(1,"div")(2,"h3",29),e.EFF(3,"Enter Login Code"),e.k0s(),e.j41(4,"p",30),e.EFF(5),e.k0s()(),e.j41(6,"div")(7,"label",31),e.EFF(8," Login Code * "),e.k0s(),e.j41(9,"div",16)(10,"input",32),e.mxI("ngModelChange",function(o){e.eBV(t);const c=e.XpG();return e.DH7(c.loginCode,o)||(c.loginCode=o),e.Njj(o)}),e.k0s()()(),e.DNE(11,x,2,1,"div",18)(12,b,2,1,"div",19),e.j41(13,"div",33)(14,"button",20),e.DNE(15,C,2,0,"span",21)(16,v,5,0,"span",22),e.k0s(),e.j41(17,"button",34),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onRequestLoginCode())}),e.DNE(18,y,2,1,"span",21)(19,L,2,0,"span",21),e.k0s()()()}if(2&n){const t=e.XpG();e.R7$(5),e.SpI(" We've sent a 6-digit login code to ",t.loginForm.email," "),e.R7$(5),e.R50("ngModel",t.loginCode),e.R7$(),e.Y8G("ngIf",t.errorMessage),e.R7$(),e.Y8G("ngIf",t.successMessage),e.R7$(2),e.Y8G("disabled",t.isLoading||6!==t.loginCode.length),e.R7$(),e.Y8G("ngIf",!t.isLoading),e.R7$(),e.Y8G("ngIf",t.isLoading),e.R7$(),e.Y8G("disabled",t.isLoading||t.countdown>0),e.R7$(),e.Y8G("ngIf",t.countdown>0),e.R7$(),e.Y8G("ngIf",0===t.countdown)}}let w=(()=>{class n{constructor(t,s){this.apiService=t,this.router=s,this.currentStep="email",this.loginForm={email:""},this.loginCode="",this.isLoading=!1,this.errorMessage="",this.successMessage="",this.countdown=0}onRequestLoginCode(){if(this.errorMessage="",this.successMessage="",this.isLoading=!0,!this.loginForm.email)return this.errorMessage="Please enter your email address",void(this.isLoading=!1);this.apiService.requestLoginCode(this.loginForm.email).subscribe({next:t=>{this.isLoading=!1,t.success?(this.successMessage=t.data?.login_code?`Login code: ${t.data.login_code} (Check your email or use this code)`:"Login code sent to your email",this.currentStep="code",this.startCountdown()):this.errorMessage=t.error||"Failed to send login code"},error:t=>{this.isLoading=!1,this.errorMessage=this.apiService.getErrorMessage(t)}})}onLogin(){6===this.loginCode.length?(this.errorMessage="",this.successMessage="",this.isLoading=!0,this.apiService.loginWithCode(this.loginForm.email,this.loginCode).subscribe({next:t=>{this.isLoading=!1,t.success?(this.apiService.setCurrentUser(t.data.user),this.apiService.setAuthToken(t.data.session_token),this.clearCountdown(),this.router.navigate(["/announcements"])):this.errorMessage=t.error||"Login failed"},error:t=>{this.isLoading=!1,this.errorMessage=this.apiService.getErrorMessage(t)}})):this.errorMessage="Please enter a 6-digit login code"}startCountdown(){this.countdown=60,this.countdownTimer=setInterval(()=>{this.countdown--,this.countdown<=0&&this.clearCountdown()},1e3)}clearCountdown(){this.countdownTimer&&(clearInterval(this.countdownTimer),this.countdownTimer=void 0),this.countdown=0}goToSignup(){this.router.navigate(["/signup"])}ngOnDestroy(){this.clearCountdown()}static{this.\u0275fac=function(s){return new(s||n)(e.rXU(d.G),e.rXU(u.Ix))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-login"]],standalone:!0,features:[e.aNF],decls:20,vars:2,consts:[[1,"min-h-screen","bg-gray-50","flex","flex-col","justify-center","py-12","sm:px-6","lg:px-8"],[1,"sm:mx-auto","sm:w-full","sm:max-w-md"],[1,"mt-6","text-center","text-3xl","font-extrabold","text-gray-900"],[1,"mt-2","text-center","text-sm","text-gray-600"],[1,"mt-8","sm:mx-auto","sm:w-full","sm:max-w-md"],[1,"bg-white","py-8","px-4","shadow","sm:rounded-lg","sm:px-10"],["class","space-y-6",3,"ngSubmit",4,"ngIf"],[1,"mt-6"],[1,"relative"],[1,"absolute","inset-0","flex","items-center"],[1,"w-full","border-t","border-gray-300"],[1,"relative","flex","justify-center","text-sm"],[1,"px-2","bg-white","text-gray-500"],[1,"w-full","flex","justify-center","py-2","px-4","border","border-gray-300","rounded-md","shadow-sm","text-sm","font-medium","text-gray-700","bg-white","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500",3,"click"],[1,"space-y-6",3,"ngSubmit"],["for","email",1,"block","text-sm","font-medium","text-gray-700"],[1,"mt-1"],["id","email","name","email","type","email","required","","placeholder","Enter your email address",1,"appearance-none","block","w-full","px-3","py-2","border","border-gray-300","rounded-md","placeholder-gray-400","focus:outline-none","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],["class","text-red-600 text-sm",4,"ngIf"],["class","text-green-600 text-sm",4,"ngIf"],["type","submit",1,"w-full","flex","justify-center","py-2","px-4","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-blue-600","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","disabled:opacity-50",3,"disabled"],[4,"ngIf"],["class","flex items-center",4,"ngIf"],[1,"text-red-600","text-sm"],[1,"text-green-600","text-sm"],[1,"flex","items-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-3","h-5","w-5","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-lg","font-medium","text-gray-900"],[1,"mt-2","text-sm","text-gray-600"],["for","loginCode",1,"block","text-sm","font-medium","text-gray-700"],["id","loginCode","name","loginCode","type","text","maxlength","6","required","","placeholder","000000",1,"appearance-none","block","w-full","px-3","py-2","border","border-gray-300","rounded-md","placeholder-gray-400","focus:outline-none","focus:ring-blue-500","focus:border-blue-500","text-center","text-2xl","tracking-widest",3,"ngModelChange","ngModel"],[1,"space-y-3"],["type","button",1,"w-full","flex","justify-center","py-2","px-4","border","border-gray-300","rounded-md","shadow-sm","text-sm","font-medium","text-gray-700","bg-white","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","disabled:opacity-50",3,"click","disabled"]],template:function(s,o){1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"h2",2),e.EFF(3," Sign in to your account "),e.k0s(),e.j41(4,"p",3),e.EFF(5," Use email verification to access your account "),e.k0s()(),e.j41(6,"div",4)(7,"div",5),e.DNE(8,h,12,6,"form",6)(9,F,20,10,"form",6),e.j41(10,"div",7)(11,"div",8)(12,"div",9),e.nrm(13,"div",10),e.k0s(),e.j41(14,"div",11)(15,"span",12),e.EFF(16,"Don't have an account?"),e.k0s()()(),e.j41(17,"div",7)(18,"button",13),e.bIt("click",function(){return o.goToSignup()}),e.EFF(19," Create Account "),e.k0s()()()()()()),2&s&&(e.R7$(8),e.Y8G("ngIf","email"===o.currentStep),e.R7$(),e.Y8G("ngIf","code"===o.currentStep))},dependencies:[g.MD,g.bT,r.YN,r.qT,r.me,r.BC,r.cb,r.YS,r.tU,r.vS,r.cV],encapsulation:2})}}return n})()}}]);