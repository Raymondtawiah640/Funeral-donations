{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { throwError, BehaviorSubject } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let ApiService = /*#__PURE__*/(() => {\n  class ApiService {\n    constructor(http) {\n      this.http = http;\n      this.baseUrl = 'https://kilnenterprise.com/Donations';\n      this.currentUserSubject = new BehaviorSubject(null);\n      this.currentUser$ = this.currentUserSubject.asObservable();\n      this.loadUserFromStorage();\n    }\n    // Authentication methods\n    signup(email, fullName, phone) {\n      return this.http.post(`${this.baseUrl}/auth.php?action=signup`, {\n        email,\n        full_name: fullName,\n        phone\n      }).pipe(catchError(this.handleError));\n    }\n    verifyEmail(email, verificationCode) {\n      return this.http.post(`${this.baseUrl}/auth.php?action=verify`, {\n        email,\n        verification_code: verificationCode\n      }).pipe(catchError(this.handleError));\n    }\n    requestLoginCode(email) {\n      return this.http.post(`${this.baseUrl}/auth.php?action=request-login`, {\n        email\n      }).pipe(catchError(this.handleError));\n    }\n    loginWithCode(email, loginCode) {\n      return this.http.post(`${this.baseUrl}/auth.php?action=login`, {\n        email,\n        login_code: loginCode\n      }).pipe(catchError(this.handleError));\n    }\n    resendVerificationCode(email) {\n      return this.http.post(`${this.baseUrl}/auth.php?action=resend-verification`, {\n        email\n      }).pipe(catchError(this.handleError));\n    }\n    // Funeral announcements methods\n    getAnnouncements() {\n      return this.http.get(`${this.baseUrl}/funeral.php`).pipe(catchError(this.handleError));\n    }\n    getAnnouncement(id) {\n      return this.http.get(`${this.baseUrl}/funeral.php?id=${id}`).pipe(catchError(this.handleError));\n    }\n    createAnnouncement(announcement) {\n      const headers = this.getAuthHeaders();\n      return this.http.post(`${this.baseUrl}/funeral.php`, announcement, {\n        headers\n      }).pipe(catchError(this.handleError));\n    }\n    updateAnnouncement(id, announcement) {\n      const headers = this.getAuthHeaders();\n      return this.http.put(`${this.baseUrl}/funeral.php?id=${id}`, announcement, {\n        headers\n      }).pipe(catchError(this.handleError));\n    }\n    closeAnnouncement(id) {\n      const headers = this.getAuthHeaders();\n      return this.http.delete(`${this.baseUrl}/funeral.php?action=close&id=${id}`, {\n        headers\n      }).pipe(catchError(this.handleError));\n    }\n    getUserAnnouncements() {\n      const headers = this.getAuthHeaders();\n      return this.http.get(`${this.baseUrl}/funeral.php?action=user-announcements`, {\n        headers\n      }).pipe(catchError(this.handleError));\n    }\n    // Donation methods\n    createDonation(donation) {\n      return this.http.post(`${this.baseUrl}/donations.php`, donation).pipe(catchError(this.handleError));\n    }\n    getDonations(announcementId, limit = 20, offset = 0) {\n      return this.http.get(`${this.baseUrl}/donations.php?announcement_id=${announcementId}&limit=${limit}&offset=${offset}`).pipe(catchError(this.handleError));\n    }\n    getDonationStats(announcementId) {\n      return this.http.get(`${this.baseUrl}/donations.php?action=stats&announcement_id=${announcementId}`).pipe(catchError(this.handleError));\n    }\n    // File upload methods\n    uploadFile(announcementId, file, uploadPurpose) {\n      const formData = new FormData();\n      formData.append('announcement_id', announcementId.toString());\n      formData.append('upload_purpose', uploadPurpose);\n      formData.append('file', file);\n      const headers = this.getAuthHeaders();\n      return this.http.post(`${this.baseUrl}/donations.php?action=upload`, formData, {\n        headers\n      }).pipe(catchError(this.handleError));\n    }\n    getFiles(announcementId) {\n      return this.http.get(`${this.baseUrl}/donations.php?action=files&announcement_id=${announcementId}`).pipe(catchError(this.handleError));\n    }\n    deleteFile(fileId) {\n      const headers = this.getAuthHeaders();\n      return this.http.delete(`${this.baseUrl}/donations.php?action=file&file_id=${fileId}`, {\n        headers\n      }).pipe(catchError(this.handleError));\n    }\n    // Contact form (existing)\n    submitContactForm(message) {\n      return this.http.post(`${this.baseUrl}/contact.php`, message).pipe(catchError(this.handleError));\n    }\n    // Utility methods\n    isLoggedIn() {\n      return !!this.currentUserSubject.value;\n    }\n    getCurrentUser() {\n      return this.currentUserSubject.value;\n    }\n    setCurrentUser(user) {\n      this.currentUserSubject.next(user);\n      if (user) {\n        localStorage.setItem('currentUser', JSON.stringify(user));\n      } else {\n        localStorage.removeItem('currentUser');\n        localStorage.removeItem('authToken');\n      }\n    }\n    getAuthHeaders() {\n      const token = localStorage.getItem('authToken');\n      let headers = new HttpHeaders();\n      if (token) {\n        headers = headers.set('Authorization', `Bearer ${token}`);\n      }\n      return headers;\n    }\n    loadUserFromStorage() {\n      const userStr = localStorage.getItem('currentUser');\n      if (userStr) {\n        try {\n          const user = JSON.parse(userStr);\n          this.currentUserSubject.next(user);\n        } catch (e) {\n          localStorage.removeItem('currentUser');\n        }\n      }\n    }\n    setAuthToken(token) {\n      localStorage.setItem('authToken', token);\n    }\n    getAuthToken() {\n      return localStorage.getItem('authToken');\n    }\n    logout() {\n      this.setCurrentUser(null);\n      this.setAuthToken('');\n    }\n    getErrorMessage(error) {\n      if (error.error && error.error.error) {\n        return error.error.error;\n      }\n      if (error.error && error.error.message) {\n        return error.error.message;\n      }\n      if (error.message) {\n        return error.message;\n      }\n      return 'An unexpected error occurred. Please try again.';\n    }\n    handleError(error) {\n      let errorMessage = 'An unknown error occurred';\n      if (error.error instanceof ErrorEvent) {\n        // Client-side error\n        errorMessage = `Client Error: ${error.error.message}`;\n      } else {\n        // Server-side error\n        if (error.error && error.error.error) {\n          errorMessage = error.error.error;\n        } else if (error.error && error.error.message) {\n          errorMessage = error.error.message;\n        } else if (error.message) {\n          errorMessage = error.message;\n        } else {\n          errorMessage = `Server Error: ${error.status} ${error.statusText}`;\n        }\n      }\n      console.error('API Error:', error);\n      return throwError(() => new Error(errorMessage));\n    }\n    static {\n      this.ɵfac = function ApiService_Factory(t) {\n        return new (t || ApiService)(i0.ɵɵinject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: ApiService,\n        factory: ApiService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return ApiService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}